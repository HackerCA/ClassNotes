// Generated by CoffeeScript 1.6.3
/*
  HTTPster
  Copyright(c) 2010 Simeon Bateman <simeon@simb.net>
  MIT Licensed
*/


(function() {
  var exec, express, fav, fs, pack, path, port, program, startDefaultServer, useCompress, _ref, _ref1, _ref2;

  fs = require('fs');

  program = require('commander');

  exec = require('child_process').exec;

  express = require('express');

  path = "./";

  port = void 0;

  fav = require('./fav');

  pack = require('../package.json');

  program.version(pack.version).option('-p, --port <port>', 'Port for server to run on - defaults to 3333').option('-d, --dir [path]', 'Server directory - defaults to ./').option('-z, --compress', 'Add support for compression').parse(process.argv);

  port = (_ref = program.port) != null ? _ref : 3333;

  path = (_ref1 = program.dir) != null ? _ref1 : fs.realpathSync(path);

  useCompress = (_ref2 = program.compress) != null ? _ref2 : false;

  startDefaultServer = function(port, path) {
    var app;
    app = express();
    if (useCompress === true) {
      app.use(express.compress());
    }
    app.use(fav(path));
    app.use(express["static"](path));
    app.use(express.directory(path));
    app.use(express.logger({
      format: "dev"
    }));
    app.use(express.errorHandler({
      dumpExceptions: true,
      showStack: true
    }));
    app.configure('production', function() {
      return app.use(express.staticCache());
    });
    app.listen(parseInt(port, 10));
    return app;
  };

  console.log("Starting HTTPster v%s on port %j from %s", pack.version, port, path);

  startDefaultServer(port, path);

}).call(this);
